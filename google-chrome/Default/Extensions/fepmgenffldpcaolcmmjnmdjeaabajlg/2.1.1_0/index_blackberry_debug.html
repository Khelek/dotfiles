<!doctype html>
 <html>
 <head>
     <meta name="apple-mobile-web-app-capable" content="yes">
     <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
     <title>OrganizeMe!</title>
     <script src="webworks-1.0.2.9.js"></script>
     <script src="enyo/framework/enyo.js" type="text/javascript"></script>
 </head>
 <body>
     <script type="text/javascript">
     
   		if (Platform.isBlackBerry()) {
			localStorage.setItem("debugOutput", true);
		}

		window.onorientationchange = function() 
		{
		    onRotate( );
		}

       	var theApp = null;
       
        function onDeviceReady(){
        	if (Util.isDebug()) {
            	console.log("starting the app");
            }

            // localStorage.clear();
            	
            if (Platform.isBB10()) {
                blackberry.event.addEventListener("connectionchange", onChange);
            }
            
			if (Platform.isBlackBerry() && (navigator.userAgent.indexOf('Version/10.0') == -1)) {
			    blackberry.app.event.onSwipeDown(showMenu);
			}
         
         	var startNormal = false;
            if (Settings.getSettings().accountVerified == true && Settings.getSettings().username != "" && Settings.getSettings().password != "") {
                startNormal = true;
            }

            this.theApp = new MeOrg( );
            // this.theApp.startNormal = startNormal;

            this.theApp.renderInto(document.body);
            
            // alert( blackberry.system.softwareVersion );

            if (Util.isDebug()) {
            	console.log("everything should be rendered right now?!");
            }
            if (startNormal == true) {
            	this.theApp.normalStart();
            } else {
            	this.theApp.showWelcomePage();
            }
        }
        
        function showMenu(){
        	if (Util.isDebug()) {
        		console.log("show menu!");
        	}
            if (this.theApp != null) {
            	this.theApp.showMenuDialog();
            }
		}

        function onRotate( ){
        	if (Util.isDebug()) {
        		console.log("onRotate detected!");
        	}
            if (this.theApp != null) {
            	this.theApp.onWindowRotated( );
            }
		}
        
        function onChange( info ){
        	if (Util.isDebug()) {
        		console.log("Connection change detected!");
        	}
            if (this.theApp != null) {
            	var online = (info.newType != blackberry.connection.NONE ? true : false);
            	var inResponse = { "isInternetConnectionAvailable": online };
                this.theApp.connectionResponseHandler( "null", inResponse );
            }
		}
        
        window.addEventListener("load", function(e) {
            document.addEventListener("webworksready", onDeviceReady);
         }, false);
        
     </script>
 </body>
 </html> 